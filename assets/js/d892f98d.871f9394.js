"use strict";(self.webpackChunkakara=self.webpackChunkakara||[]).push([[2173],{8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>t});var l=r(6540);const a={},s=l.createContext(a);function c(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),l.createElement(s.Provider,{value:n},e.children)}},8650:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>c,metadata:()=>l,toc:()=>i});const l=JSON.parse('{"id":"rust/advanced","title":"\u8fdb\u9636","description":"Unsafe Rust","source":"@site/docs/rust/advanced.md","sourceDirName":"rust","slug":"/rust/advanced","permalink":"/rust/advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/miusing/blog/tree/master/docs/rust/advanced.md","tags":[],"version":"current","frontMatter":{}}');var a=r(4848),s=r(8453);const c={},t="\u8fdb\u9636",d={},i=[{value:"Unsafe Rust",id:"unsafe-rust",level:2},{value:"Advanced Traits",id:"advanced-traits",level:2},{value:"Advanced Type",id:"advanced-type",level:2},{value:"Advanced Function",id:"advanced-function",level:2},{value:"\u5b8f\uff08Macro\uff09",id:"\u5b8fmacro",level:2},{value:"\u58f0\u660e\u5b8f",id:"\u58f0\u660e\u5b8f",level:3},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:4},{value:"\u8fc7\u7a0b\u5b8f",id:"\u8fc7\u7a0b\u5b8f",level:3},{value:"\u6d3e\u751f\u5b8f",id:"\u6d3e\u751f\u5b8f",level:4},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-1",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-1",level:4},{value:"\u5c5e\u6027\u5b8f",id:"\u5c5e\u6027\u5b8f",level:4},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-2",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-2",level:4},{value:"\u51fd\u6570\u5f0f\u5b8f",id:"\u51fd\u6570\u5f0f\u5b8f",level:4},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-3",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-3",level:4}];function o(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\u8fdb\u9636",children:"\u8fdb\u9636"})}),"\n",(0,a.jsx)(n.h2,{id:"unsafe-rust",children:"Unsafe Rust"}),"\n",(0,a.jsx)(n.h2,{id:"advanced-traits",children:"Advanced Traits"}),"\n",(0,a.jsx)(n.h2,{id:"advanced-type",children:"Advanced Type"}),"\n",(0,a.jsx)(n.h2,{id:"advanced-function",children:"Advanced Function"}),"\n",(0,a.jsx)(n.h2,{id:"\u5b8fmacro",children:"\u5b8f\uff08Macro\uff09"}),"\n",(0,a.jsxs)(n.p,{children:["\u5b8f\u662f\u4e00\u79cd\u5143\u7f16\u7a0b\uff0c\u901a\u8fc7\u5728\u7f16\u8bd1\u65f6\u5bf9\u6307\u5b9a\u7684\u6e90\u4ee3\u7801\u8fdb\u884c\u66ff\u6362\uff08\u5373\u5b8f\u5c55\u5f00\uff09\u53ef\u5b9e\u73b0\u5404\u79cd\u8fdb\u9636\u7684\u80fd\u529b\u3002Rust\u4e2d\u7684\u5b8f\u5206\u4e3a",(0,a.jsx)(n.strong,{children:"\u58f0\u660e\u5b8f"}),"\uff08",(0,a.jsx)(n.em,{children:"declarative macros"}),"\uff09\u548c\u4ee5\u4e0b\u4e09\u79cd",(0,a.jsx)(n.strong,{children:"\u8fc7\u7a0b\u5b8f"}),"\uff08 ",(0,a.jsx)(n.em,{children:"procedural macros"}),"\uff09"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u6d3e\u751f\u5b8f\uff08",(0,a.jsxs)(n.em,{children:["Custom ",(0,a.jsx)(n.code,{children:"#[derive]"})," macros"]}),"\uff09"]}),"\n",(0,a.jsxs)(n.li,{children:["\u5c5e\u6027\u5b8f\uff08",(0,a.jsx)(n.em,{children:"Attribute-like macros"}),"\uff09"]}),"\n",(0,a.jsxs)(n.li,{children:["\u51fd\u6570\u5f0f\u5b8f\uff08",(0,a.jsx)(n.em,{children:"Function-like macros"}),"\uff09"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u58f0\u660e\u5b8f\u548c\u8fc7\u7a0b\u5b8f\u4e2d\u7684\u51fd\u6570\u5f0f\u5b8f\u5728\u529f\u80fd\u4e0a\u5341\u5206\u8d34\u8fd1\uff0c\u4f7f\u7528\u4e0a\u4e5f\u90fd\u548c\u666e\u901a\u51fd\u6570\u975e\u5e38\u76f8\u4f3c\uff0c\u4e8c\u8005\u533a\u522b\u5728\u4e8e\u58f0\u660e\u5b8f\u4e3b\u8981\u662f\u505a\u5b57\u7b26\u4e32\u5c42\u9762\u4e0a\u7684\u5339\u914d\u4e0e\u66ff\u6362\uff0c\u800c\u8fc7\u7a0b\u5b8f\u662f\u57fa\u4e8eToken\u6d41\u4e43\u81f3\u8bed\u6cd5\u6811\u5c42\u9762\u4e0a\u7684\u64cd\u4f5c\u3002\u53e6\u5916\u76f8\u8f83\u4e8e\u666e\u901a\u51fd\u6570\u7684\u529f\u80fd\u6765\u8bf4\uff0c\u5b8f\u6700\u5927\u7684\u7279\u522b\u662f\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u5c55\u5f00\uff0c\u5177\u5907\u66f4\u5f3a\u5927\u7684\u8868\u8fbe\u80fd\u529b\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u58f0\u660e\u5b8f",children:"\u58f0\u660e\u5b8f"}),"\n",(0,a.jsx)(n.h4,{id:"\u5b9a\u4e49",children:"\u5b9a\u4e49"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"#[macro_export]\nmacro_rules! vec {\n    ( $( $x:expr ),* ) => {\n        {\n            let mut temp_vec = Vec::new();\n            $(\n                temp_vec.push($x);\n            )*\n            temp_vec\n        }\n    };\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"let v: Vec<u32> = vec![1, 2, 3];\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u8fc7\u7a0b\u5b8f",children:"\u8fc7\u7a0b\u5b8f"}),"\n",(0,a.jsx)(n.h4,{id:"\u6d3e\u751f\u5b8f",children:"\u6d3e\u751f\u5b8f"}),"\n",(0,a.jsx)(n.p,{children:"\u6d3e\u751f\u5b8f\u4e3b\u8981\u88ab\u7ed3\u6784\u4f53\u6216\u679a\u4e3e\u7c7b\u578b\u8fdb\u884c\u6d88\u8d39\uff0c\u6700\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u7ed9\u7ed3\u6784\u4f53\u63d0\u4f9b\u67d0\u4e2aTrait\u7684\u9ed8\u8ba4\u5b9e\u73b0\u3002"}),"\n",(0,a.jsx)(n.h4,{id:"\u5b9a\u4e49-1",children:"\u5b9a\u4e49"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'use proc_macro::TokenStream;\nuse quote::quote;\nuse syn;\n\n#[proc_macro_derive(HelloMacro)]\npub fn hello_macro_derive(input: TokenStream) -> TokenStream {\n    // Construct a representation of Rust code as a syntax tree\n    // that we can manipulate\n    let ast = syn::parse(input).unwrap();\n\n    // Build the trait implementation\n    impl_hello_macro(&ast)\n}\n\nfn impl_hello_macro(ast: &syn::DeriveInput) -> TokenStream {\n    let name = &ast.ident;\n    let gen = quote! {\n        impl HelloMacro for #name {\n            fn hello_macro() {\n                println!("Hello, Macro! My name is {}!", stringify!(#name));\n            }\n        }\n    };\n    gen.into()\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u4f7f\u7528-1",children:"\u4f7f\u7528"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use hello_macro::HelloMacro;\nuse hello_macro_derive::HelloMacro;\n\n#[derive(HelloMacro)]\nstruct Pancakes;\n\nfn main() {\n    Pancakes::hello_macro();\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u5c5e\u6027\u5b8f",children:"\u5c5e\u6027\u5b8f"}),"\n",(0,a.jsx)(n.p,{children:"\u5c5e\u6027\u5b8f\u4e0d\u4ec5\u53ef\u4ee5\u88ab\u7528\u6765\u66ff\u6362\u7ed3\u6784\u4f53\u548c\u679a\u4e3e\uff0c\u8fd8\u80fd\u66ff\u6362\u51fd\u6570\u7b49\u6e90\u4ee3\u7801\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u4f7f\u7528\u5c5e\u6027\u5b8f\u7684\u65f6\u5019\u53ef\u4ee5\u63a5\u6536\u66f4\u591a\u989d\u5916\u7684\u53c2\u6570\u3002"}),"\n",(0,a.jsx)(n.h4,{id:"\u5b9a\u4e49-2",children:"\u5b9a\u4e49"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"#[proc_macro_attribute]\npub fn route(attr: TokenStream, item: TokenStream) -> TokenStream {\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u4f7f\u7528-2",children:"\u4f7f\u7528"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'#[route(GET, "/")]\nfn index() {\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u51fd\u6570\u5f0f\u5b8f",children:"\u51fd\u6570\u5f0f\u5b8f"}),"\n",(0,a.jsx)(n.p,{children:"\u51fd\u6570\u5f0f\u5b8f\u5728\u4f7f\u7528\u4e0a\u7c7b\u4f3c\u4e8e\u76f4\u63a5\u8c03\u7528\u51fd\u6570\u3002"}),"\n",(0,a.jsx)(n.h4,{id:"\u5b9a\u4e49-3",children:"\u5b9a\u4e49"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"#[proc_macro]\npub fn sql(input: TokenStream) -> TokenStream {\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u4f7f\u7528-3",children:"\u4f7f\u7528"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"let sql = sql!(SELECT * FROM posts WHERE id=1);\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);