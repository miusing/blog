"use strict";(self.webpackChunkakara=self.webpackChunkakara||[]).push([[5381],{8121:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>r});const l=JSON.parse('{"id":"mongodb","title":"MongoDB","description":"\u5e38\u7528\u547d\u4ee4","source":"@site/docs/mongodb.md","sourceDirName":".","slug":"/mongodb","permalink":"/docs/mongodb","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/mongodb.md","tags":[],"version":"current","frontMatter":{"sidebarDepth":4},"sidebar":"tutorialSidebar","previous":{"title":"\u7f16\u7a0b\u9898","permalink":"/docs/\u7f16\u7a0b\u9898"},"next":{"title":"Mysql","permalink":"/docs/mysql"}}');var d=o(4848),c=o(8453);const s={sidebarDepth:4},a="MongoDB",i={},r=[{value:"\u5e38\u7528\u547d\u4ee4",id:"\u5e38\u7528\u547d\u4ee4",level:2},{value:"\u67e5\u770b\u6570\u636e\u5e93",id:"\u67e5\u770b\u6570\u636e\u5e93",level:3},{value:"\u65b0\u5efa/\u5207\u6362\u6570\u636e\u5e93",id:"\u65b0\u5efa\u5207\u6362\u6570\u636e\u5e93",level:3},{value:"\u5220\u9664\u6570\u636e\u5e93",id:"\u5220\u9664\u6570\u636e\u5e93",level:3},{value:"\u67e5\u770b\u6240\u6709Collections",id:"\u67e5\u770b\u6240\u6709collections",level:3},{value:"\u65b0\u5efaCollection",id:"\u65b0\u5efacollection",level:3},{value:"\u5220\u9664Collection",id:"\u5220\u9664collection",level:3},{value:"\u67e5\u627e\u6570\u636e",id:"\u67e5\u627e\u6570\u636e",level:3},{value:"Mongoose",id:"mongoose",level:2},{value:"\u6dfb\u52a0\u6570\u636e",id:"\u6dfb\u52a0\u6570\u636e",level:3},{value:"\u67e5\u627e\u6570\u636e",id:"\u67e5\u627e\u6570\u636e-1",level:3},{value:"\u66f4\u65b0\u6570\u636e",id:"\u66f4\u65b0\u6570\u636e",level:3},{value:"Query",id:"query",level:3},{value:"<code>_id</code>",id:"_id",level:3},{value:"<code>createdAt</code>\u3001<code>updatedAt</code>",id:"createdatupdatedat",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"mongodb",children:"MongoDB"})}),"\n",(0,d.jsx)(n.h2,{id:"\u5e38\u7528\u547d\u4ee4",children:"\u5e38\u7528\u547d\u4ee4"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"mongo # \u8fdb\u5165\u6570\u636e\u5e93\u7684cli\u4ea4\u4e92\u754c\u9762\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u67e5\u770b\u6570\u636e\u5e93",children:"\u67e5\u770b\u6570\u636e\u5e93"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"show dbs\n# \u9ed8\u8ba4\u6709\u8fd9\u4e09\u4e2a\uff08\u8fd8\u6709\u4e2atest\u6570\u636e\u5e93\uff0c\u7531\u4e8e\u521d\u59cb\u8be5\u6570\u636e\u5e93\u5185\u5bb9\u4e3a\u7a7a\uff0c\u6240\u4ee5\u4e0d\u663e\u793a\uff09\n# admin \n# config\n# local\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u65b0\u5efa\u5207\u6362\u6570\u636e\u5e93",children:"\u65b0\u5efa/\u5207\u6362\u6570\u636e\u5e93"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"use <\u6570\u636e\u5e93\u540d>\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u5220\u9664\u6570\u636e\u5e93",children:"\u5220\u9664\u6570\u636e\u5e93"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"use <\u76ee\u6807\u6570\u636e\u5e93>\ndb.dropDatabase() \n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u67e5\u770b\u6240\u6709collections",children:"\u67e5\u770b\u6240\u6709Collections"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"show collections\n# \u663e\u793a\u5f53\u524d\u6570\u636e\u5e93\u7684\u6240\u6709\u96c6\u5408\uff08\u7c7b\u4f3cMysql\u4e2d\u7684\u6570\u636e\u5e93\u8868\uff09\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u65b0\u5efacollection",children:"\u65b0\u5efaCollection"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"db.createCollection(<\u96c6\u5408\u540d>)\n# js\u4ee3\u7801 \n# const p = mongoose.model('people', schema)\n# p.save()\n# \u4f1a\u521b\u5efa\u4e00\u4e2a\u96c6\u5408peoples\uff08\u6ce8\u610f\uff1a\u8fd9\u91cc\u662f\u590d\u6570\uff09\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u5220\u9664collection",children:"\u5220\u9664Collection"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"db.<\u96c6\u5408\u540d>.drop()\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u67e5\u627e\u6570\u636e",children:"\u67e5\u627e\u6570\u636e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"db.<\u96c6\u5408\u540d>.find() #\u67e5\u627e\u5f53\u524d\u96c6\u5408\u7684\u6240\u6709\u6570\u636e \ndb.<\u96c6\u5408\u540d>.find({name: 'akara'}) # \u6839\u636e\u6761\u4ef6\u67e5\u627e\n"})}),"\n",(0,d.jsx)(n.h2,{id:"mongoose",children:"Mongoose"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Node"}),"\u4e2d\u4e3b\u8981\u6709\u4e24\u4e2a\u5e93\u6765\u8fde\u63a5",(0,d.jsx)(n.code,{children:"Mongodb"}),"\u6570\u636e\u5e93\uff0c\u5206\u522b\u662f\u540c\u540d\u7684",(0,d.jsx)(n.code,{children:"mongodb"}),"\u548c",(0,d.jsx)(n.code,{children:"mongoose"}),"\uff0c\u901a\u5e38\u6211\u4eec\u4f7f\u7528",(0,d.jsx)(n.code,{children:"Mongoose"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const mongoose = require('mongoose')\n// mongodb\u9ed8\u8ba4\u8fd0\u884c\u572827017 port\nmongoose.connect('mongodb://localhost/test', { // test\u4e3a\u6570\u636e\u5e93\u540d\n    useNewUrlParser: true,\n    useUnifiedTopology: true\n}) \nconst db = mongoose.connection\ndb.once('open', function () {\n    // \u5b9a\u4e49Schema\n    const peopleSchema = new mongoose.Schema({ \n        name: String,\n    })\n\n    // \u5b9a\u4e49Model\n    // \u4f1a\u5efa\u7acb\u4e00\u4e2a\u540d\u4e3apeoples(\u590d\u6570)\u7684Collection\n    const People = mongoose.model('people', peopleSchema) // Model { people }\n\n    // p\u662f\u4e00\u4e2aDocument\n    const p = new People({ \n        name: 'akara'\n    }) \n\n    await p.save()\n})\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u6dfb\u52a0\u6570\u636e",children:"\u6dfb\u52a0\u6570\u636e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const People = mongoose.model('people', peopleSchema)\nconst p = new People({\n    name: 'www'\n})\np.save() // Document\u7684\u5b9e\u4f8b\u65b9\u6cd5save\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e86",(0,d.jsx)(n.code,{children:"Document"}),"\u7684\u5b9e\u4f8b\u65b9\u6cd5",(0,d.jsx)(n.code,{children:"save"}),"\uff0c\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5b9e\u4f8b\u65b9\u6cd5\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"peopleSchema.methods.say = function() {\n    console.log('say something')\n}\nconst Model = mongoose.model('people', peopleSchema) \np.say()\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u67e5\u627e\u6570\u636e-1",children:"\u67e5\u627e\u6570\u636e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const People = mongoose.model('people', peopleSchema)\n\n// \u67e5\u627eCollection\u4e2d\u6240\u6709Document\nPeople.find(function (err, data) {  // Model\u7684\u9759\u6001\u65b9\u6cd5find\n    console.log(data)\n})\n\n// \u6839\u636e\u641c\u7d22\u6761\u4ef6\u67e5\u627e\u6570\u636e\nPeople.find({name: 'akara'}, function (err, data) { \n    console.log(data)\n})\n\n// ----------------- \u5206\u5272\u7ebf ----------------\n// \u5f53\u7136\uff0c\u9664\u4e86\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528async/await\u6765\u5b9e\u73b0\n\nconst data = await People.find()\n// or \nconst data = await People.find({name: 'akara'})\nconsole.log(data)\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e86",(0,d.jsx)(n.code,{children:"Model"}),"\u7684\u9759\u6001\u65b9\u6cd5",(0,d.jsx)(n.code,{children:"find"}),"\u6765\u67e5\u627e\u6570\u636e\uff0c\u9664\u4e86\u81ea\u5e26\u7684\u9759\u6001\u65b9\u6cd5\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u7ed9",(0,d.jsx)(n.code,{children:"Model"}),"\u8fd9\u4e2a\u7c7b\u6dfb\u52a0\u9759\u6001\u65b9\u6cd5\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"peopleSchema.statics.findByName = function(name) {\n    return this.find({ name }) // \u8fd9\u91cc\u7684this\u662fModel\n}\n// or\npeopleSchema.static('findByName', function(name) {\n    return this.find({ name })\n})\n\nconst People = mongoose.model('people', peopleSchema)\nlet data = await People.findByName('akara')\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5e38\u7528API\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"Model.find()"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"Model.findOne()"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"Model.count()"})}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u66f4\u65b0\u6570\u636e",children:"\u66f4\u65b0\u6570\u636e"}),"\n",(0,d.jsxs)(n.p,{children:["\u5728",(0,d.jsx)(n.code,{children:"mongoose"}),"\u4e2d\u66f4\u65b0\u6570\u636e\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u9700\u8981\u5148\u67e5\u8be2\u5230\u76ee\u6807Document\uff0c\u7136\u540e\u4ee5\u7eafJS\u7684\u5f62\u5f0f\u4fee\u6539\u5b83\u7684\u5c5e\u6027\uff0c\u6700\u540e\u8c03\u7528",(0,d.jsx)(n.code,{children:"save"}),"\u5373\u53ef\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const People = mongoose.model('people', peopleSchema)\nlet p = await People.findOne()\np.name = 'newName'\nawait p.save()\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u4ee5\u4e0a\u662f\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u5e94\u8be5\u7528\u6765\u66f4\u65b0\u6570\u636e\u7684\u65b9\u5f0f\uff0c\u53ea\u6709\u5c11\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4f7f\u7528",(0,d.jsx)(n.code,{children:"update()"}),"\u3001",(0,d.jsx)(n.code,{children:"updateOne()"}),"\u3001",(0,d.jsx)(n.code,{children:"updateMany()"}),"\u3001",(0,d.jsx)(n.code,{children:"findOneAndUpdate()"}),"\u7b49\u65b9\u5f0f\u6765\u66f4\u65b0\u6570\u636e\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"query",children:"Query"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Model.find()"}),"\u672c\u8eab\u8fd4\u56de\u7684\u503c\u662f\u4e00\u4e2a",(0,d.jsx)(n.code,{children:"Query"}),"\u7c7b\u7684\u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u7c7b\u5f53\u7136\u662f",(0,d.jsx)(n.code,{children:"Mongoose"}),"\u5e93\u81ea\u5e26\u7684\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"console.log(Model.find()) // Query {}\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Query"}),"\u7c7b\u5b9e\u9645\u4e0a\u662f\u7ee7\u627f\u4e8e",(0,d.jsx)(n.code,{children:"Promise"}),"\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u53ef\u4ee5\u4f7f\u7528",(0,d.jsx)(n.code,{children:"await Model.find()"}),"\u7684\u5f62\u52bf\u83b7\u53d6\u5176\u5185\u90e8\u503c\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const data = await Model.find()\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Query"}),"\u662f\u53ef\u4ee5\u94fe\u5f0f\u64cd\u4f5c\u7684\uff0c\u5c31\u50cf",(0,d.jsx)(n.code,{children:"Promise"}),"\u4e5f\u53ef\u4ee5\u901a\u8fc7",(0,d.jsx)(n.code,{children:".then"}),"\u6765\u94fe\u5f0f\u64cd\u4f5c\u4e00\u6837\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"let data = await People.find().where('age').gte(10).lte(20)\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u4eec\u4e5f\u53ef\u4ee5\u53bb\u81ea\u5b9a\u4e49\u94fe\u5f0f\u64cd\u4f5c\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u7f16\u5199\u5b98\u7f51\u6240\u8bf4\u7684",(0,d.jsx)(n.code,{children:"Query Helper"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"peopleSchema.query.byName = function(name) {\n    return this.find({name})\n}\n\nlet data = await People.find().byName('akara')\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u53e6\u5916",(0,d.jsx)(n.code,{children:"Query"}),"\u5b9e\u4f8b\u4e0a\u7684",(0,d.jsx)(n.code,{children:"exec"}),"\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u8ba9\u6211\u4eec\u62ff\u5230\u6570\u636e"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const query = People.find()\nquery.exec((err, data) => console.log(data))\n"})}),"\n",(0,d.jsx)(n.h3,{id:"_id",children:(0,d.jsx)(n.code,{children:"_id"})}),"\n",(0,d.jsxs)(n.p,{children:["\u6bcf\u4e2aDocument\u9ed8\u8ba4\u90fd\u4f1a\u6709\u4e00\u6761",(0,d.jsx)(n.code,{children:"_id"}),"\u7684\u5c5e\u6027"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"{ _id: ObjectId(\"5ff59ae87b43e51eccf83237\"), ...} // _id\u662f\u4e2a\u5bf9\u8c61\n\nawait Model.findById('5ff59ae87b43e51eccf83237') // \u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u6570\u636e \n"})}),"\n",(0,d.jsxs)(n.h3,{id:"createdatupdatedat",children:[(0,d.jsx)(n.code,{children:"createdAt"}),"\u3001",(0,d.jsx)(n.code,{children:"updatedAt"})]}),"\n",(0,d.jsx)(n.p,{children:"\u7528\u4e8e\u81ea\u52a8\u7ed9\u5b57\u6bb5\u6dfb\u52a0\u521b\u5efa\u65f6\u95f4\u548c\u4fee\u6539\u65f6\u95f4"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const peopleSchema = new mongoose.Schema({ \n    name: String,\n}, {\n    timestamps: {},\n    // \u4e5f\u53ef\u4ee5\u7ed9\u5b57\u6bb5\u6539\u540d\n    // timestamps: {\n    //     createdAt: 'created_at'\n    // }\n})\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(t,{...e})}):t(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>a});var l=o(6540);const d={},c=l.createContext(d);function s(e){const n=l.useContext(c);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),l.createElement(c.Provider,{value:n},e.children)}}}]);